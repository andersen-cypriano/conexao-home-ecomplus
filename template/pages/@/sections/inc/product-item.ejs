<%
const itemData = {}
let itemDataFields = ['_id', 'sku', 'slug', 'quantity', 'keywords']
if (Array.isArray(_.itemDataFields)) {
  itemDataFields = itemDataFields.concat(_.itemDataFields)
}
itemDataFields.forEach(field => itemData[field] = opt.item[field])
itemData.name = _.ecomUtils.name(opt.item)
itemData.price = _.ecomUtils.price(opt.item)

const imgObj = _.ecomUtils.img(opt.item)
if (imgObj) {
  itemData.pictures = [{
    _id: _.ecomUtils.randomObjectId(),
    normal: imgObj
  }]
}
%>

<article class="product-item" data-product="<%= JSON.stringify(itemData) %>">
  <div
    class="product-card"
    data-product-id="<%= itemData._id %>"
    data-sku="<%= itemData.sku %>"
    <% if (!opt.static) { %>
      data-to-render="true"
    <% } %>
  >
    <!--
      `ProductCard` should be rendered (hydrated) here:
      https://developers.e-com.plus/storefront/@ecomplus/storefront-components/docs/ProductCard.html
    -->
    <a
      href="/<%= itemData.slug %>"
      class="product-card__link"
      title="<%= itemData.name %>"
    >
      <!-- Custom code on product card top wrapped by link:
      <span data-slot="header">
      </span>
      -->

      <div class="product-card__pictures">
        <!-- Picture(s) will be inserted and loaded dynamically within `ProductCard` -->
        <% if (imgObj) { %>
          <picture class="product-card__picture">
            <img
              data-src="<%= imgObj.url %>"
              alt="<%= imgObj.alt %>"
              class="lozad-delay fade"
              <% if (imgObj.url.startsWith('https://ecoms1.com/')) { %>
                crossorigin="anonymous"
              <% } %>
            >
          </picture>
        <% } %>
      </div>

      <div data-slot="title">
        <h3 class="product-card__name">
          <%= itemData.name %>
        </h3>
      </div>
    </a>

    <% if (itemData.keywords) {%>
      <div class="mt-4 pt-4 p-list">
        <% for (let x = 0; x < itemData.keywords.length; x++) { console.log(itemData.keywords[x], itemData.name)%>
        <div class="item d-flex align-items-center">                            
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.2803 7.28033C13.5732 6.98744 13.5732 6.51256 13.2803 6.21967C12.9874 5.92678 12.5126 5.92678 12.2197 6.21967L13.2803 7.28033ZM7.49999 12L6.96966 12.5303C7.26255 12.8232 7.73742 12.8232 8.03032 12.5303L7.49999 12ZM5.78028 9.21967C5.48739 8.92678 5.01251 8.92678 4.71962 9.21967C4.42673 9.51257 4.42673 9.98744 4.71963 10.2803L5.78028 9.21967ZM12.2197 6.21967L6.96966 11.4697L8.03032 12.5303L13.2803 7.28033L12.2197 6.21967ZM4.71963 10.2803L6.96966 12.5303L8.03031 11.4697L5.78028 9.21967L4.71963 10.2803ZM15 9C15 12.3137 12.3137 15 9 15V16.5C13.1421 16.5 16.5 13.1421 16.5 9H15ZM9 15C5.68629 15 3 12.3137 3 9H1.5C1.5 13.1421 4.85786 16.5 9 16.5V15ZM3 9C3 5.68629 5.68629 3 9 3V1.5C4.85786 1.5 1.5 4.85786 1.5 9H3ZM9 3C12.3137 3 15 5.68629 15 9H16.5C16.5 4.85786 13.1421 1.5 9 1.5V3Z" fill="#F0839A"/>
          </svg>
          <span>
            <%- itemData.keywords[x] %>
          </span>

        </div>  
        <% } %>
      </div>
      <% }%>

    <div class="product-card__prices prices">
      <strong class="prices__value">
        <% if (opt.item.available && opt.item.visible && _.ecomUtils.inStock(opt.item)) { %>
          <%= _.ecomUtils.formatMoney(itemData.price) %>
        <% } else { %>
          --
        <% } %>
      </strong>
    </div>

    <!-- Customize add to cart button content:
    <div data-slot="buy-button-content">
      <i class="i-shopping-bag mr-1"></i>
      {{ _.dictionary('buy') }}
    </div>
    -->

    <div class="spinner-border spinner-border-sm fade" role="status">
      <span class="sr-only">Loading...</span>
    </div>

    <%- await include('@/helpers/widgets-append', {
      _, opt, field: 'productCardSlots'
    }) %>
  </div>

  <%- await include('@/helpers/widgets-append', {
    _, opt, field: 'productItemAppend'
  }) %>
</article>
